(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{315:function(s,t,a){"use strict";a.r(t);var r=a(0),e=Object(r.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h2",{attrs:{id:"服务器端配置："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务器端配置：","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务器端配置：")]),s._v(" "),a("p",[s._v("1、安装xinetd,并修改rsync相关配置")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum -y install xinetd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/xinetd.d/rsync")]),s._v("\n")])])]),a("p",[s._v("如下代码：")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("service rsync\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        disable "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" yes\n        socket_type     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" stream\n        wait            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no\n        user            "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root\n        server          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rsync\n        server_args     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("daemon\n        log_on_failure  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("USERID")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("将disable = yes改成disable = no\n然后重启xinetd")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /etc/init.d/xinetd restart")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  注：如果服务器上装有防火墙，需要打开端口，默认端口是873\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# telnet 127.0.0.1 873")]),s._v("\n  Trying 127.0.0.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  telnet: connect to address 127.0.0.1: Connection refused\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -A INPUT -s 192.168.0.0/255.255.255.0 -p tcp -m tcp --dport 873 -j ACCEPT")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -A INPUT -p tcp -m tcp --dport 873 -j DROP")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("p",[s._v("2、编写rsync.conf配置文件")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/rsyncd.conf")]),s._v("\n")])])]),a("p",[s._v("内容如下：")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("873")]),s._v("\nuid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nobody\ngid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nobody\nuser chroot "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no\nmax connections "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\ntimeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\npid file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rsyncd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid\nlock file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("run"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rsyncd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lock\nlog file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rsyncd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log\n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("www"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\npath "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("www\nignore errors\nread only "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no\nlist "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no\nhosts allow "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".255")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v(" 设置允许访问的ip 可以为"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("（所有）\nauth users "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" root\nsecrets file "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rsyncd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("secrets\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("注释：\nport  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开放端口")]),s._v("\nuid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nobody  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进行备份的用户UID，nobody为任何用户")]),s._v("\ngid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nobody  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进行备份的组GID，nobody为任意组")]),s._v("\nuse "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chroot")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#如果"use chroot"指定为true，那么rsync在传输文件以前首先chroot到path参数所指定的目录下。这样做的原因是实现额外的安全防护，但是缺 点是需要以root权限，并且不能备份指向外部的符号连接所指向的目录文件。默认情况下chroot值为true。但是这个一般不需要，所以我选择no或 false')]),s._v("\nlist "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不允许列清单")]),s._v("\nmax connections "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 200 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#最大连接数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 600 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#覆盖客户指定的IP超时时间，也就是说rsync服务器不会永远等待一个崩溃的客户端。")]),s._v("\npidfile "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/rsyncd.pid  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pid文件的存放位置")]),s._v("\nlock "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/run/rsync.lock  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#锁文件的存放位置")]),s._v("\nlog "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/log/rsyncd.log  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#日志文件的存放位置")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("backup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里是认证模块名，即跟samba语法一样，是对外公布的名字")]),s._v("\npath "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /home/www  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里是参与同步的目录")]),s._v("\nignore errors  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#可以忽略一些无关的IO错误")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("read")]),s._v(" only "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#允许可读可写")]),s._v("\nlist "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" no  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不允许列清单")]),s._v("\nhosts allow "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 192.168.1.0/255.255.255.0  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这里跟samba的语法是一样的，只允许192.168.1.0/24的网段进行同步，拒绝其它一切IP")]),s._v("\nauth "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" admin  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证的用户名")]),s._v("\nsecrets "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/rsyncd.secrets  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#密码文件存放地址")]),s._v("\n")])])]),a("p",[s._v("注意：对于这个地方的配置文件，虽然解释的很清楚，可是一些朋友始终还会在这里出错，这里我提亮点易错点：\n[backup]是认证模块名和 path = /var/www 是参与同步的目录\n这里的path 大家要记好了，这里不要随便的一设置就直接完事，要知道这里是认证模块的，以后从客户机备份的数据会存储在这里。")]),s._v(" "),a("p",[s._v("3、编写用户密码文件")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/rsyncd.secrets")]),s._v("\nroot:1234789 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#用户名:密碼")]),s._v("\n")])])]),a("p",[s._v("4、给予只读权限")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chown root:root /etc/rsyncd.secrets")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod 600 /etc/rsyncd.secrets")]),s._v("\n")])])]),a("p",[s._v("-rw------- (600) -- 只有属主有读写权限。")]),s._v(" "),a("p",[s._v("-rw-r--r-- (644) -- 只有属主有读写权限；而属组用户和其他用户只有读权限。")]),s._v(" "),a("p",[s._v("-rwx------ (700) -- 只有属主有读、写、执行权限。")]),s._v(" "),a("p",[s._v("-rwxr-xr-x (755) -- 属主有读、写、执行权限；而属组用户和其他用户只有读、执行权限。")]),s._v(" "),a("p",[s._v("-rwx--x--x (711) -- 属主有读、写、执行权限；而属组用户和其他用户只有执行权限。")]),s._v(" "),a("p",[s._v("-rw-rw-rw- (666) -- 所有用户都有文件读、写权限。这种做法不可取。")]),s._v(" "),a("p",[s._v("-rwxrwxrwx (777) -- 所有用户都有读、写、执行权限。更不可取的做法。")]),s._v(" "),a("p",[s._v("以下是对目录的两个普通设定：")]),s._v(" "),a("p",[s._v("drwx------ (700) - 只有属主可在目录中读、写。")]),s._v(" "),a("p",[s._v("drwxr-xr-x (755) - 所有用户可读该目录，但只有属主才能改变目录中的内容")]),s._v(" "),a("p",[s._v("suid的代表数字是4，比如4755的结果是-rwsr-xr-x")]),s._v(" "),a("p",[s._v("sgid的代表数字是2，比如6755的结果是-rwsr-sr-x")]),s._v(" "),a("p",[s._v("sticky位代表数字是1，比如7755的结果是-rwsr-sr-t")]),s._v(" "),a("p",[s._v("5、创建目录并修改所有者")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir /home/www/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chown -R nobody:nobody /home/www")]),s._v("\n")])])]),a("p",[s._v("6、启动服务")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rsync --daemon")]),s._v("\n")])])]),a("p",[s._v("7、加入开机自启动")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "rsync --daemon">> /etc/rc.local')]),s._v("\n")])])]),a("p",[s._v("二、Linux客户端进行同步\n1、客户端默认好像已经装了rsync，没有的话装下：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum -y install rsync")]),s._v("\n")])])]),a("p",[s._v("2、创建密码文件")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/rsyncd.passwd")]),s._v("\n文件内容如下"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("只包含密码部分"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("：\n123456789\n")])])]),a("p",[s._v("3、执行异步同步操作：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/bin/rsync -avz --progress --password-file=/etc/rsyncd.passwdroot@192.168.1.1::www /home/www")]),s._v("\n")])])])])}],!1,null,null,null);t.default=e.exports}}]);