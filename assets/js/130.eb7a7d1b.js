(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{316:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),a("p",[t._v("安装 rsync 包。必须在源计算器和目标计算器上都安装 rsync")]),t._v(" "),a("p",[t._v("使用方法\n搜索 "),a("a",{attrs:{href:"https://bbs.archlinux.org/viewforum.php?id=27",target:"_blank",rel:"noopener noreferrer"}},[t._v("Community Contributions"),a("OutboundLink")],1),t._v(" 和 "),a("a",{attrs:{href:"https://bbs.archlinux.org/viewforum.php?id=33",target:"_blank",rel:"noopener noreferrer"}},[t._v("General Programming"),a("OutboundLink")],1),t._v(" 可以得到更多的例子。")]),t._v(" "),a("p",[t._v("作为 cp 的替代\nrsync 可以作为 cp 命令的高级替代品，特别在复制较大的文件的场景中：")]),t._v(" "),t._m(3),a("p",[t._v("其中 -P 与 --partial --progress 选项的作用是相同的，该选项使得文件可以分块传输并显示传输过程中的进度。")]),t._v(" "),a("p",[t._v("您可能需要使用 -r --recursive 选项使目录被递归地传输。")]),t._v(" "),a("p",[t._v("通过 cp 命令，可以本地复制文件，但 rsync 令人激动的一个特性是可以远程复制文件，例如，在两个不同的主机之间。远程位置可以用主机加冒号进行指定：")]),t._v(" "),t._m(4),a("p",[t._v("或者")]),t._v(" "),t._m(5),a("p",[t._v("网络文件传输默认使用 SSH 协议")]),t._v(" "),t._m(6),t._v(" "),t._m(7),a("p",[t._v('创建一个有着 "source"内容的 "destination/source"目录，命令：')]),t._v(" "),t._m(8),a("p",[t._v('把"source/"目录下的所有文件全部复制到"destination"目录下，而没有中间的子目录 - 就像你调用了：')]),t._v(" "),t._m(9),a("p",[t._v('这与 GNU cp 的行为是不同的，在GNU cp中"source" 与 "source/" 意义相同 (不是"source/.")。此外，一些shell可以在你键入Tab补全的时候自动自动给目录追加尾部下划线。由于这些因素，可以有新的或不熟练的rsync用户倾向于忘记的rsync的不同行为，在命令行上留下了结尾的下划线，从而无意间创造一个烂摊子，甚至覆盖重要文件。')]),t._v(" "),a("p",[t._v("谨慎起见，可以使用包装脚在调用rsync之前自动删除尾部斜杠：")]),t._v(" "),t._m(10),a("p",[t._v("该脚本可以放在某个路径下，并在shell的init文件中把别名改为rsync。")]),t._v(" "),a("p",[t._v("作为备份工具\nrsync协议可以很容易地用于备份，只传输自上次备份以来已更改的文件。本节将介绍一个非常简单的基于rsync的计划备份脚本，通常用于复制到可移动介质。对于更详尽的例子， 保留一些系统文件所需的附加选项, 参见 Full system backup with rsync.")]),t._v(" "),a("p",[t._v("自动备份\n以下面的脚本为例，该脚本放置于 /etc/cron.daily 目录下，如果 cron daemon 被正确安装和配置，它将每天运行。配置和使用 cron 是本文的范围之外。")]),t._v(" "),a("p",[t._v("首先，创建一个包含相应命令选项的脚本：")]),t._v(" "),t._m(11),t._m(12),t._v(" "),a("p",[t._v("最后，脚本必须是可执行的：")]),t._v(" "),t._m(13),a("p",[t._v("自动用 SSH 备份\n如果是通过 SSH 备份到远程主机，改为使用此脚本：")]),t._v(" "),a("p",[t._v("/etc/cron.daily/backup")]),t._v(" "),t._m(14),t._m(15),t._v(" "),a("p",[t._v("告诉rsync的使用SSH")]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),a("p",[t._v("首先，创建一个包含相应命令选项的脚本：")]),t._v(" "),a("p",[t._v("/etc/NetworkManager/dispatcher.d/backup")]),t._v(" "),t._m(19),t._m(20),t._v(" "),t._m(21),t._v(" "),t._m(22),t._v(" "),a("p",[t._v("限I / O带宽;每秒千字节")]),t._v(" "),a("p",[t._v("Also, the script must have write permission for owner (root, of course) only (see NetworkManager dispatcher for details).")]),t._v(" "),t._m(23),t._v(" "),a("p",[t._v("~/.config/systemd/user/backup.path")]),t._v(" "),t._m(24),a("p",[t._v("~/.config/systemd/user/backup.service")]),t._v(" "),t._m(25),t._m(26),t._v(" "),a("p",[t._v("这个 rsync 选项很有用，可以每日创建全量或增量备份。")]),t._v(" "),a("p",[t._v("首先，创建一个包含相应命令选项的脚本：")]),t._v(" "),t._m(27),t._m(28),t._v(" "),t._m(29),t._v(" "),a("p",[t._v("略。。。")])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"rsync"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rsync","aria-hidden":"true"}},[this._v("#")]),this._v(" rsync")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("https://wiki.archlinux.org/index.php/Rsync_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)#%E5%AE%89%E8%A3%85")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("rsync")]),this._v(" -P "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("source")]),this._v(" destination\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("rsync")]),this._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("source")]),this._v(" host:destination\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("rsync")]),this._v(" host:source destination\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("无论是本地或远程文件传输， rsync 首先创建每个源文件块校验的索引。此索引用于查找可能存在于目标中的任何相同数据块。一旦这种块存在，块就被就地使用，而不是从源复制。这大大加快了存在小差异的大文件的同步。欲了解更多信息，请参见 official documentation, how rsync works 。")])]),this._v(" "),s("li",[s("p",[this._v("注意尾随下划\nArch 默认使用 GNU cp (part of GNU coreutils). 然而，rsync 遵循 BSD cp 的约定, 源目录后面带有一个斜杠“/”有着特定的处理。比如：")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("rsync")]),this._v(" -r "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("source")]),this._v(" destination\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("rsync")]),this._v(" -r source/ destination\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[this._v("rsync")]),this._v(" -r source/. destination\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/zsh")]),t._v("\nnew_args"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$@")]),t._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" /"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" */"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${i%/}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" esac\n    new_args+"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$i")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("done")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rsync")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${(@)new_args}")]),t._v('"')]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("/etc/cron.daily/backup\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rsync")]),t._v(" -a --delete /folder/to/backup /location/of/backup "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/null\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("-a\n表示文件应被存档，这意味着他们的大部分特性被保留 (不包括ACLs, 硬链接或扩展属性，如capabilities)")]),this._v(" "),s("li",[this._v("--delete\n指同步源文件的删除操作。\n在这里，/folder/to/backup 应该改成需要被备份的路径 (比如 /home)，/location/to/backup 是备份应存放的位置 (比如 /media/disk).")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[this._v("# chmod +x /etc/cron.daily/backup")]),this._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rsync")]),t._v(" -a --delete -e "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ssh")]),t._v(" /folder/to/backup remoteuser@remotehost:/location/of/backup "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/null\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("-e ssh")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("remoteuser ：远程主机 remotehost 上的用户名")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("-a")]),this._v("\n组中的所有这些选项 -rlptgoD (recursive, links, perms, times, group, owner, devices)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("自动使用NetworkManager备份\n该脚本在你接入网络后开始备份。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[t._v("#!/bin/bash")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" x"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xup"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rsync")]),t._v(" --force --ignore-errors -a --delete --bwlimit"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("2000 --files-from"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("files.rsync /folder/to/backup /location/to/backup\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("-a")]),this._v("\n组中的所有选项 -rlptgoD recursive, links, perms, times, group, owner, devices")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("--files-from")]),this._v("\n从文件中读取到备份路径/folder/to/backup的相对路径")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("--bwlimit")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"使用systemd和inotify自动备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用systemd和inotify自动备份","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用systemd和inotify自动备份")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nDescription"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Checks "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" paths that are currently being backed up have changed\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nPathChanged"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("%h/documents\nPathChanged"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("%h/music\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nWantedBy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("default.target\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nDescription"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Backs up files\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nExecStart"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/usr/bin/rsync %h/./documents %h/./music -CERrltm --delete ubuntu:\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"一个星期差异备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一个星期差异备份","aria-hidden":"true"}},[this._v("#")]),this._v(" 一个星期差异备份")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("/etc/cron.daily/backup\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#!/bin/bash")]),t._v("\n\nDAY"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),t._v(" +%A"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" -e /location/to/backup/incr/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAY")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("then")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -fr /location/to/backup/incr/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAY")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fi")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rsync")]),t._v(" -a --delete --inplace --backup --backup-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/location/to/backup/incr/"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$DAY")]),t._v(" /folder/to/backup/ /location/to/backup/full/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /dev/null\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("--inplace\nimplies --partial update destination files in-place")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"快照备份"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快照备份","aria-hidden":"true"}},[this._v("#")]),this._v(" 快照备份")])}],!1,null,null,null);s.default=n.exports}}]);